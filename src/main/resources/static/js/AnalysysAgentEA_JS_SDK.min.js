!function (e) {
    "function" == typeof define && define.amd ? define(e) : e()
}(function () {
    "use strict";
    var u = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";

    function e() {
    }

    e.prototype.paramType = function (e) {
        return Object.prototype.toString.call(e).replace("[object ", "").replace("]", "")
    }, e.prototype.objHasKay = function (e, t) {
        return Object.prototype.hasOwnProperty.call(e, t)
    }, e.prototype.encode = function (e) {
        var t, n, o, a, i, r, s, l = "", c = 0;
        for (e = function d(e) {
            e = e.replace(/\r\n/g, "\n");
            for (var t = "", n = 0; n < e.length; n++) {
                var o = e.charCodeAt(n);
                o < 128 ? t += String.fromCharCode(o) : (127 < o && o < 2048 ? t += String.fromCharCode(o >> 6 | 192) : (t += String.fromCharCode(o >> 12 | 224), t += String.fromCharCode(o >> 6 & 63 | 128)), t += String.fromCharCode(63 & o | 128))
            }
            return t
        }(e); c < e.length;) a = (t = e.charCodeAt(c++)) >> 2, i = (3 & t) << 4 | (n = e.charCodeAt(c++)) >> 4, r = (15 & n) << 2 | (o = e.charCodeAt(c++)) >> 6, s = 63 & o, isNaN(n) ? r = s = 64 : isNaN(o) && (s = 64), l = l + u.charAt(a) + u.charAt(i) + u.charAt(r) + u.charAt(s);
        return l
    }, e.prototype.decode = function (e) {
        var t, n, o, a, i, r, s = "", l = 0;
        for (e = e.replace(/[^A-Za-z0-9\+\/\=]/g, ""); l < e.length;) t = u.indexOf(e.charAt(l++)) << 2 | (a = u.indexOf(e.charAt(l++))) >> 4, n = (15 & a) << 4 | (i = u.indexOf(e.charAt(l++))) >> 2, o = (3 & i) << 6 | (r = u.indexOf(e.charAt(l++))), s += String.fromCharCode(t), 64 != i && (s += String.fromCharCode(n)), 64 != r && (s += String.fromCharCode(o));
        return s = function c(e) {
            for (var t = "", n = 0, o = 0, a = 0, i = 0; n < e.length;) (o = e.charCodeAt(n)) < 128 ? (t += String.fromCharCode(o), n++) : 191 < o && o < 224 ? (a = e.charCodeAt(n + 1), t += String.fromCharCode((31 & o) << 6 | 63 & a), n += 2) : (a = e.charCodeAt(n + 1), i = e.charCodeAt(n + 2), t += String.fromCharCode((15 & o) << 12 | (63 & a) << 6 | 63 & i), n += 3);
            return t
        }(s)
    }, e.prototype.isEmptyObject = function (e) {
        var t;
        for (t in e) return !1;
        return !0
    }, e.prototype.deviceType = function () {
        var e = navigator.userAgent;
        return -1 < e.indexOf("Tablet") && e.indexOf("PC") < 0 || -1 < e.indexOf("Pad") || -1 < e.indexOf("Nexus 7") ? "tablet" : -1 < e.indexOf("Mobi") || -1 < e.indexOf("iPh") || -1 < e.indexOf("480") ? "phone" : "desktop"
    }, e.prototype.ready = function (e) {
        document.addEventListener ? document.addEventListener("DOMContentLoaded", function () {
            document.removeEventListener("DOMContentLoaded", arguments.callee, !1), e()
        }, !1) : document.attachEvent && document.attachEvent("onreadystatechange", function () {
            "complete" == document.readyState && (document.detachEvent("onreadystatechange", arguments.callee), e())
        })
    }, e.prototype.getUrlDomain = function (e) {
        return e ? e.split("?")[0] : e
    }, e.prototype.checkURL = function (e) {
        var t = e;
        return 1 == new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/).test(t)
    }, e.prototype.isMatch = function (e, t) {
        if (e) {
            var n = !1;
            if (0 === e.split("").reverse().join("").indexOf("*")) {
                var o = e.split("*");
                n = 0 === t.indexOf(o[0])
            }
            return n
        }
    };
    var x = new e, t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) {
        return typeof e
    } : function (e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    }, o = "", n = "";
    try {
        o = "object" == t(window.localStorage) ? window.localStorage : "", n = "object" == t(window.sessionStorage) ? window.sessionStorage : ""
    } catch (C) {
    }

    function a() {
        this.localName = "FZ_EA_STROAGE", this.sessionName = "FZ_EA_SESSION", this.localObj = this.getLocal(), this.sessionObj = this.getSession()
    }

    a.prototype.setLocal = function (e, t) {
        this.localObj = this.getLocal(), this.localObj[e] = t;
        try {
            o.setItem(this.localName, x.encode(JSON.stringify(this.localObj)))
        } catch (C) {
        }
    }, a.prototype.getLocal = function (e) {
        try {
            var t = o.getItem(this.localName);
            return this.localObj = JSON.parse(x.decode(t)), e ? this.localObj[e] : this.localObj
        } catch (C) {
            return e ? "" : {}
        }
    }, a.prototype.getUatLocal = function (e) {
        try {
            var t = o.getItem("FZ_STROAGE") || {}, n = JSON.parse(x.decode(t));
            return e ? n[e] : n
        } catch (C) {
            return e ? "" : {}
        }
    }, a.prototype.removeLocal = function (e) {
        this.localObj = this.getLocal(), x.objHasKay(this.localObj, e) && delete this.localObj[e]
    }, a.prototype.setSession = function (e, t) {
        this.sessionObj = this.getSession(), this.sessionObj[e] = t;
        try {
            n.setItem(this.sessionName, x.encode(JSON.stringify(this.sessionObj)))
        } catch (C) {
        }
    }, a.prototype.getSession = function (e) {
        try {
            var t = n.getItem(this.sessionName) || {};
            return this.sessionObj = JSON.parse(x.decode(t)), e ? this.sessionObj[e] : this.sessionObj
        } catch (C) {
            return {}
        }
    };
    var T = new a;

    function i(e) {
        if ("Object" == x.paramType(e)) return e;
        if ("String" != x.paramType(e)) return {code: 200};
        -1 < e.indexOf("\n") && (e = e.replace(/[\r\n]/g, ""));
        try {
            return JSON.parse(toByteArray(e), {to: "string"})
        } catch (C) {
            try {
                return JSON.parse(e)
            } catch (C) {
                return {code: 200}
            }
        }
    }

    function r() {
        var e = null;
        if (window.XDomainRequest) return new XDomainRequest;
        if (window.XMLHttpRequest) e = new XMLHttpRequest; else try {
            e = new ActiveXObject("Microsoft.XMLHTTP")
        } catch (C) {
            try {
                e = new ActiveXObject("Msxml2.XMLHTTP")
            } catch (t) {
                e = new XMLHttpRequest
            }
        }
        return e
    }

    function s(n) {
        var o = !1, a = new r;
        a.onload = function (e) {
            o || (o = !0, n.success(i(a.responseText), a))
        }, a.onerror = function (e) {
            o || (o = !0, n.error(i(a.responseText), a))
        }, a.onreadystatechange = function () {
            if (4 == a.readyState) {
                try {
                    if (-1 < a.getAllResponseHeaders().indexOf("Date") || -1 < a.getAllResponseHeaders().indexOf("date")) {
                        var e = +new Date, t = a.getResponseHeader("Date") || a.getResponseHeader("date");
                        t && T.setLocal("ANSSERVERTIME", new Date(t) - e)
                    }
                } catch (C) {
                }
                if (200 <= a.status && a.status < 300 || 304 == a.status) {
                    if (o) return;
                    o = !0, n.success(i(a.responseText), a)
                } else {
                    if (o) return;
                    o = !0, n.error()
                }
                a.onreadystatechange = null, a.onload = null
            }
        };
        try {
            a.open(n.type, n.url, !0), a.setRequestHeader("Content-type", "application/json; charset=utf-8"), "GET" === n.type ? a.send(null) : a.send(n.data)
        } catch (C) {
        }
    }

    function d() {
        this.xhr = r(), this.url = "", this.data = "", this.type = "GET", this.success = function () {
        }, this.error = function () {
        }
    }

    function l() {
        return +new Date + (T.getUatLocal("ANSSERVERTIME") ? Number(T.getUatLocal("ANSSERVERTIME")) : 0)
    }

    function L() {
        var e = new Date;
        return e.setTime(e.getTime()), e.getFullYear().toString() + (e.getMonth() + 1).toString() + e.getDate().toString()
    }

    function f() {
        return "1.1.8"
    }

    function O() {
        return +new Date
    }

    d.prototype.get = function (e) {
        var t = [];
        for (var n in e.data) t.push(n + "=" + encodeURIComponent(e.data[n]));
        var o = -1 < e.url.indexOf("?") ? e.url + "&" + t.join("&") : e.url + "?" + t.join("&");
        this.url = o, this.data = e.data, this.type = "GET", this.success = e.success || function () {
        }, this.error = e.error || function () {
        }, s(this)
    }, d.prototype.post = function (e) {
        this.url = e.url, this.data = e.data, this.type = "POST", this.contentType = "application/json; charset=utf-8", this.success = e.success || function () {
        }, this.error = e.error || function () {
        }, s(this)
    };
    var c, h,
        p = (h = !(c = []), document.addEventListener ? (document.addEventListener("DOMContentLoaded", g, !1), document.addEventListener("readystatechange", g, !1), window.addEventListener("load", g, !1)) : document.attachEvent && (document.attachEvent("onreadystatechange", g), window.attachEvent("onload", g)), function (e) {
            h ? e.call(document) : c.push(e)
        });

    function g(e) {
        if (!h && ("onreadystatechange" !== e.type || "complete" === document.readyState)) {
            for (var t = 0; t < c.length; t++) c[t].call(document);
            h = !0, c = null
        }
    }

    var v = function v(e, t) {
        var n = !1, o = t["function"], a = null, i = t.dataType, r = !1;
        for (var s in e) s === t.field && (a = e[s]), "$url_domain" === t.field && "$url" === s && (r = !0, a = e[s]);
        if ("EQ" === o) if ("$url" === t.field || "$url_domain" === t.field) {
            var l = r ? x.getUrlDomain(a) : a, c = r ? x.getUrlDomain(t.value[0]) : t.value[0],
                d = "$url" === t.field || r;
            l === c ? n = !0 : d && (n = x.isMatch(c, l))
        } else n = !(-1 === t.value.indexOf(a)); else if ("NOT_EQ" === o) n = !(-1 !== t.value.indexOf(a)); else if ("CONTAIN" === o) for (var u = 0, f = 0; f < t.value.length; f++) a && -1 !== a.indexOf(t.value[f]) && u++, u === t.value.length && (n = !0); else if ("NOT_CONTAIN" === o) for (u = 0, f = 0; f < t.value.length; f++) a && -1 === a.indexOf(t.value[f]) && u++, u === t.value.length && (n = !0); else if ("NOT_NULL" === o) switch (i) {
            case"string":
                n = !!a;
                break;
            case"array":
            case"array<string>":
                n = !!a.length;
                break;
            default:
                n = !(null === a)
        } else if ("NULL" === o) switch (i) {
            case"string":
                n = !a;
                break;
            case"array":
                n = !a.length;
                break;
            case"array<string>":
                n = !!a.length;
                break;
            default:
                n = !(null !== a)
        } else if ("LT" === o) for (f = 0; f < t.value.length; f++) a < Number(t.value[f]) && (n = !0); else if ("LTE" === o) for (f = 0; f < t.value.length; f++) a <= Number(t.value[f]) && (n = !0); else if ("GT" === o) for (f = 0; f < t.value.length; f++) a > Number(t.value[f]) && (n = !0); else if ("GTE" === o) for (f = 0; f < t.value.length; f++) a >= Number(t.value[f]) && (n = !0); else "TRUE" === o ? n = !(!0 !== a) : "FALSE" === o ? n = !(!1 !== a) : "RELATIVE_TIME_RANGE_CUURENT" !== o && "ABSOLUTE_TIME" !== o || 2 === t.value.length && null !== a && new Date(t.value[0]).getTime() <= new Date(a).getTime() <= new Date(t.value[1]).getTime() && (n = !0);
        return n
    };

    function y(s, l) {
        var e = window.AnalysysAgentModalConfig, t = {
            sdkVersion: f(),
            appKey: e.appKey,
            os: {platform: "web", mac: "qaew", packageName: "com.analysys.eaApp"}
        }, c = function c(e) {
            if (0 === Number(e.code)) {
                console.log("EA -- 鐧诲綍鎴愬姛"), T.setLocal("EATOKEN" + L(), e.token);
                var t = e.rule && e.rule.dayDialogMaxCount,
                    n = 0 === t ? -99999 : t - (T.getLocal(s + "DAYPOP" + L()) || 0);
                T.setLocal(e.token + s + L(), n);
                var o = T.getLocal("updateTime" + s), a = T.getLocal();
                for (var i in a) if (-1 < i.indexOf("updateTime")) {
                    T.setLocal("EAUSER", s);
                    break
                }
                var r = !1;
                (r = !o || !(o.toString() === (e.rule && e.rule.activityUpdateTime).toString())) && T.setLocal("updateTime" + s, e.rule && e.rule.activityUpdateTime), l && l(e, r)
            } else console.warn("EA -- 鐧诲綍澶辫触")
        }, n = {
            url: e.configURL + "push/sdk/login", data: JSON.stringify(t), success: c, error: function () {
                console.warn("EA -- 鐧诲綍澶辫触")
            }
        };
        (new d).post(n)
    }

    var m = window.AnalysysAgentModalConfig, b = null, E = null;

    function w() {
        this.userId = T.getSession("EAUSERID"), this.token = null, this.updateTime = null, this.isDealModalData = !1, this.isFirstGetStorageData = !0, this.queueData = [], this.isFetchData = !1, this.cacheData = []
    }

    function D(e) {
        if (e) {
            var t = x.deviceType();
            m.isH5 && (t = "phone");
            var n = document.createElement("div"), o = "AnalysysModal" + e.id;
            n.id = o;
            var a = [], i = T.getLocal("CURRENTMODALDOMID");
            if (i && 0 < i.length) {
                var r = T.getLocal("CHACHDATA") || [];
                -1 === r.indexOf(e.id) && -1 === i.indexOf(e.id) && (r.unshift(e.id), T.setLocal("CHACHDATA", r))
            } else {
                if (a.push(o), T.setLocal("CURRENTMODALDOMID", a), n.className = "AnalysysModal  AnalysysModal-" + t, e.htmlView) n.innerHTML = JSON.parse(e.htmlView); else {
                    n.style = "position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999;";
                    var s = document.createElement("div");
                    s.style = "background-color: rgba(0,0,0,0.6);position: absolute;top: 0;bottom: 0;left: 0;right: 0;", n.appendChild(s);
                    var l = document.createElement("div");
                    l.style = "phone" !== t ? "position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); -ms-transform: translate(-50%,-50%); -webkit-transform: translate(-50%,-50%);" : "position: absolute; top: 50%; left: 50%; width: 90%; transform: translate(-50%,-50%); -ms-transform: translate(-50%,-50%); -webkit-transform: translate(-50%,-50%);", l.innerHTML = function c(e, t) {
                        var n = '<img src="' + e.picture + '"  class="ans-pic-img" />',
                            o = '\n    <span class="ans-title">' + (e.title && e.title.text) + '</span>\n    <div class="ans-content">' + (e.content && e.content.text) + "</div>\n  ",
                            a = e.buttonMiddle;
                        1 === e.style ? o += n : 2 === e.style && (o = n + o);
                        return '\n  <style>\n    .AnalysysModal {\n      width: auto;\n    }\n    .AnalysysModal div {\n      width: auto;\n    }\n    .AnalysysModal button {\n      width: auto;\n    }\n    .ans-web-modal {\n      min-width: 460px;\n      max-width: 600px;\n      max-height: 420px;\n      background: #fff;\n      border-radius: 2px;\n      position:relative;\n    }\n    .AnalysysModal-phone .ans-web-modal {\n      min-width: 80%;\n      width: 100%;\n      max-width: 100%;\n    }\n    .ans-web-modal .ans-web-modal-icon-close {\n      position: absolute;\n      right: 7px;\n      top: 5px;\n      font-size: 12px;\n      color: rgba(68, 68, 68, 0.5);\n      font-weight: bolder;\n      cursor: pointer;\n    }\n    .ans-web-modal .ans-web-modal-content {\n      padding: 30px 40px;\n      text-align: center;\n    }\n    .AnalysysModal-phone .ans-web-modal .ans-web-modal-content {\n      padding: 30px;\n    }\n    .ans-web-modal .ans-web-modal-content .ans-title {\n      font-size: 16px;\n      font-weight: bolder;\n    }\n    .ans-web-modal .ans-web-modal-content .ans-content {\n      text-align: left;\n      padding: 15px 0;\n      color: #666;\n      word-break: break-all;\n      min-height: 60px;\n      white-space: pre-wrap;\n      white-space: -moz-pre-wrap;\n      white-space: -pre-wrap;\n      white-space: -o-pre-wrap;\n      *word-wrap: break-word;\n      *white-space : normal;\n    }\n    .ans-web-modal .ans-pic-img {\n      max-width: 520px;\n      max-height: 153px;\n      display: block;\n      margin-bottom: 30px;\n    }\n    .AnalysysModal-phone .ans-web-modal .ans-pic-img  {\n      max-width: 100%;\n    }\n    .ans-web-modal .ans-btn-primary {\n      background: #679BFF;\n      border-radius: 2px;\n      font-size: 12px;\n      padding: 8px 40px;\n      color: #fff;\n      height: 32px;\n      cursor: pointer;\n      border: 1px solid #679BFF;\n      text-shadow: none;\n      box-shadow: none;\n    }\n  </style>\n  <div class="ans-web-modal">\n    <span class="ans-web-modal-icon-close" onclick="\n      var c = {\n        id: \'' + e.id + "',\n        closeDialogType: '" + e.closeDialogType + "',\n        count: '" + e.count + "'\n      }\n      window.ansModalClose(c, '" + t + '\')\n    "> X </span>\n    <div class="ans-web-modal-content">\n      ' + o + '\n      <button class="ans-btn-primary" onclick="\n      var d = {\n        id: \'' + e.id + "',\n        href: '" + (a && a.clickEvent) + "',\n        closeDialogType: '" + e.closeDialogType + "',\n        count: '" + e.count + "'\n      }\n      window.ansModalOK(d, '" + t + "')\n      \" >" + (a && a.text) + "</button>\n    </div>\n  </div>"
                    }(e, o), n.append(l)
                }
                document.body.appendChild(n), S("$impDialog", {activityId: e.id, $dialog_type: 1})
            }
        }
    }

    function A(e, t) {
        var n = T.getLocal(b + "DAYPOP" + L()) || 0;
        "TEST_EQUIPMENT" !== e.activityType && T.setLocal(b + "DAYPOP" + L(), n + 1);
        var o = T.getLocal(E + b + L());
        -99999 !== o && "TEST_EQUIPMENT" !== e.activityType && T.setLocal(E + b + L(), o - 1);
        var a = T.getLocal(e.id + "POPUPTIMES") || 0;
        if (T.setLocal(e.id + "POPUPTIMES", a + 1), e.dialogRule) {
            for (var i = null, r = 0; r < e.dialogRule.length; r++) if (e.dialogRule[r].eventType === t) {
                i = e.dialogRule[r];
                break
            }
            if (i) {
                T.setLocal("EAPOPEVENTTYPE" + e.id + b, t);
                var s = O();
                T.setLocal("EAPOPNOWFORMAT" + e.id, s)
            }
        } else {
            var l = e.closeDialogType;
            1 === Number(l) ? T.setLocal("EAPOP" + e.id + L(), 0) : T.setLocal("EAPOP" + e.id, 0)
        }
    }

    function M(e, t) {
        if (!function i(e) {
            var t = e.parentNode;
            t && t.removeChild(e)
        }(document.getElementById(e)), function r(e) {
            var t = -1;
            e || T.setLocal("CURRENTMODALDOMID", []);
            for (var n = T.getLocal("CURRENTMODALDOMID") || [], o = 0; o < n.length; o++) if (n[o] === e) {
                t = o;
                break
            }
            -1 !== t && n.splice(o, 1), T.setLocal("CURRENTMODALDOMID", n)
        }(e), t) T.setLocal("CHACHDATA", []); else {
            var n = T.getLocal(E + b + L());
            if (!(-99999 !== n && n <= 0)) {
                var o = T.getLocal("CHACHDATA") || [], a = o.length;
                if (0 < a) D(function s(e) {
                    for (var t = null, n = T.getLocal("POPMODALDATA" + b), o = 0; o < n.length; o++) if (n[o].id === e) {
                        t = n[o];
                        break
                    }
                    return t
                }(o[a - 1])), 1 === a ? o = [] : o.pop(), T.setLocal("CHACHDATA", o)
            }
        }
    }

    function S(e, t, n) {
        var o = 2 < arguments.length && n !== undefined && n, a = {
            token: E,
            os: {platform: "web"},
            sdkVersion: f(),
            userId: b,
            events: [{xwho: b, xwhen: l(), xwhat: e, xcontext: t}]
        };
        if (o) {
            a.events = [];
            for (var i = 0; i < t.length; i++) a.events.push({xwho: b, xwhen: l(), xwhat: e, xcontext: t[i]})
        }
        var r = {
            url: m.configURL + "push/sdk/in_app/callback", data: JSON.stringify(a), success: function () {
            }, error: function () {
                console.warn("涓婃姤澶辫触")
            }
        };
        (new d).post(r)
    }

    w.getInstance = function () {
        return this.ansModal || (this.ansModal = new w)
    }, w.prototype.mergeLocalData = function () {
        if (!T.getLocal("ISMERGELOCAL")) {
            var e = ["EATOKEN", "updateTime", "ISGETMODALDATA", "POPMODALDATA", "EAPOP", "POPUPTIMES", "EAUSERID", "DAYPOP"],
                t = T.getUatLocal();
            for (var n in t) for (var o = 0; o < e.length; o++) -1 < n.indexOf(e[o]) && T.setLocal(n, t[n])
        }
    }, w.prototype.setConfig = function () {
        var e = window.AnalysysAgentModalConfig;
        return e.appKey ? (console.log("EA -- appKey: 璁剧疆鎴愬姛 (" + e.appKey + ")"), e.configURL ? x.checkURL(e.configURL) ? ("/" !== e.configURL.charAt(e.configURL.length - 1) && (e.configURL += "/"), console.log("EA -- configURL: 璁剧疆鎴愬姛 (" + e.configURL + ")"), window.AnalysysAgentModalConfig = e, !0) : (console.warn("EA -- configURL: 璁剧疆澶辫触锛岃杈撳叆姝ｇ‘鐨刄RL鍦板潃"), !1) : (console.warn("EA -- configURL: 璁剧疆澶辫触锛岃杈撳叆鏁版嵁鑾峰彇URL鍦板潃"), !1)) : (console.warn("EA -- appKey: 璁剧疆澶辫触锛岃杈撳叆appKey"), !1)
    }, w.prototype.init = function (n) {
        var o = this;
        if (n) {
            for (var e = T.getLocal("CURRENTMODALDOMID") || [], t = e.length, a = 0; a < t; a++) {
                document.getElementById(e[a]) || e.splice(a, 1)
            }
            if (T.setLocal("CURRENTMODALDOMID", e), this.isFetchData) for (var i = 0; i < n.length; i++) this.queueData.push(n[i]); else {
                var r = T.getLocal("EATOKEN" + L());
                for (a = 0; a < n.length; a++) {
                    if (this.isFetchData) return;
                    if ("$startup" !== n[a].xwhat && this.userId === n[a].xwho && r) {
                        this.setUserId(n[a].xwho), this.setToken(r), this.getStorageModalData(n);
                        break
                    }
                    this.isFetchData = !0, this.setUserId(n[a].xwho), y(this.userId, function (e, t) {
                        o.setToken(e.token), t ? o.fetchAnsModal(n) : (o.isFetchData = !1, o.getStorageModalData(n))
                    });
                    break
                }
            }
        }
    }, w.prototype.getStorageModalData = function (e) {
        var t = this;
        this.updateTime = T.getLocal("updateTime" + this.userId);
        var n = T.getLocal("ISGETMODALDATA" + this.userId + this.updateTime), o = [];
        this.isFirstGetStorageData && (console.log("EA -- 鎴愬姛鑾峰彇寮圭獥閰嶇疆"), this.isFirstGetStorageData = !1), n ? (o = T.getLocal("POPMODALDATA" + this.userId)) && o.length !== [] && p(function () {
            t.modalBlock(e, o)
        }) : this.fetchAnsModal(e)
    }, w.prototype.fetchAnsModal = function (i) {
        var r = this,
            e = {token: this.token, os: {platform: "web"}, userId: this.userId, newUser: T.getLocal("EAUSER") ? 1 : 0};
        this.updateTime = T.getLocal("updateTime" + this.userId), T.setLocal("EAUSER", this.userId);
        var s = function s(e) {
            if (0 === Number(e.code)) {
                console.log("EA -- 鎴愬姛鎷夊彇寮圭獥閰嶇疆");
                var t = e.data.length;
                if (0 < t) {
                    for (var n = [], o = 0; o < t; o++) n.push({$dialog_type: 0, activityId: e.data[o].id});
                    S("$pullDialog", n, !0)
                }
                var a = e.data;
                T.setLocal("ISGETMODALDATA" + b + r.updateTime, !0), T.setLocal("POPMODALDATA" + b, a), setTimeout(function () {
                    r.isFetchData = !1
                }, 0), i && 0 !== i.length && p(function () {
                    r.modalBlock(i, a)
                }), 0 < r.queueData.length && p(function () {
                    r.modalBlock(r.queueData, a), r.queueData = []
                })
            } else console.warn("EA -- 鎷夊彇寮圭獥閰嶇疆澶辫触")
        }, t = {
            url: m.configURL + "push/sdk/in_app", data: JSON.stringify(e), success: s, error: function () {
                console.warn("EA -- 鎷夊彇寮圭獥閰嶇疆澶辫触")
            }
        };
        (new d).post(t)
    }, w.prototype.modalBlock = function (e, t) {
        for (var n, o, a, i = T.getLocal(this.token + this.userId + L()), r = 0; r < t.length; r++) {
            var s = t[r];
            if (!(-99999 !== i && i <= 0 && "TEST_EQUIPMENT" !== s.activityType)) {
                if (s.dialogRule) {
                    if (s.dialogRule && 0 < s.dialogRule.length) {
                        for (var l = T.getLocal("EAPOPEVENTTYPE" + s.id + this.userId), c = null, d = 0; d < s.dialogRule.length; d++) s.dialogRule[d].eventType === l && (c = s.dialogRule[d]);
                        if (c) {
                            if (1 === c.type) continue;
                            if (2 === c.type) {
                                p = T.getLocal(s.id + "POPUPTIMES") || 0;
                                if (c.count - p <= 0) continue
                            }
                            var u = (n = c.intervalValue, o = c.intervalType, a = Number(n), "hour" === o ? 60 * a * 60 * 1e3 : "day" === o ? 24 * a * 60 * 60 * 1e3 : void 0),
                                f = T.getLocal("EAPOPNOWFORMAT" + s.id) || 0, h = O();
                            if (f && h < f + u) continue
                        }
                    }
                } else {
                    if (0 === (1 === s.closeDialogType ? T.getLocal("EAPOP" + s.id + L()) : T.getLocal("EAPOP" + s.id))) continue;
                    if (0 !== s.count) {
                        var p = T.getLocal(s.id + "POPUPTIMES") || 0;
                        if (s.count - p <= 0) continue
                    }
                }
                for (var g = 0; g < e.length; g++) {
                    var v = e[g];
                    if (s.preEvents) {
                        var y = T.getLocal("PREEVENTINDEX" + s.id) || 0;
                        s.event ? s.event.xwhat === v.xwhat && y === s.preEvents.length ? this.judeTriggerProps(v, s.event, function () {
                            D(s), T.setLocal("PREEVENTINDEX" + s.id, 0)
                        }) : s.preEvents.length > y && s.preEvents[y].xwhat === v.xwhat && this.judeTriggerProps(v, s.preEvents[y], function () {
                            T.setLocal("PREEVENTINDEX" + s.id, y + 1)
                        }) : s.preEvents.length > y && s.preEvents[y].xwhat === v.xwhat && this.judeTriggerProps(v, s.preEvents[y], function () {
                            T.setLocal("PREEVENTINDEX" + s.id, y + 1), y + 1 === s.preEvents.length && (D(s), T.setLocal("PREEVENTINDEX" + s.id, 0))
                        })
                    } else if (s.preEvent) if (s.event) {
                        var m = null;
                        for (var d in v.xcontext) "$session_id" === d && (m = v.xcontext[d]);
                        var E = T.getLocal("isTriggerPreEvent" + s.id + m);
                        E && s.event.xwhat === v.xwhat ? this.judeTriggerProps(v, s.event, function () {
                            D(s)
                        }) : s.preEvent.xwhat !== v.xwhat || E || this.judeTriggerProps(v, s.preEvent, function () {
                            T.setLocal("isTriggerPreEvent" + s.id + m, !0), s.isTriggerPreEvent = !0
                        })
                    } else s.preEvent.xwhat === v.xwhat && this.judeTriggerProps(v, s.preEvent, function () {
                        D(s)
                    }); else {
                        if (!s.event) {
                            console.log("EA -- 鏁版嵁寮傚父");
                            break
                        }
                        if (0 === s.type) {
                            var w = !1;
                            v.xcontext.$url && s.event.xcontext.$url && (w = x.isMatch(s.event.xcontext.$url, v.xcontext.$url));
                            var A = x.getUrlDomain(s.event.xcontext.$url) === x.getUrlDomain(v.xcontext.$url);
                            if (s.event.xwhat === v.xwhat && (A || w)) this.judeRule(v, s.event) && D(s)
                        } else s.event.xwhat === v.xwhat && this.judeTriggerProps(v, s.event, function () {
                            D(s)
                        })
                    }
                }
            }
        }
        T.setLocal("POPMODALDATA" + b, t)
    }, w.prototype.judeRule = function (e, t) {
        var n = !1;
        if (t.rule && 0 !== t.rule.length) for (var o = 0, a = t.rule.length, i = 0; i < a; i++) {
            v(e.xcontext, t.rule[i]) && o++, o === a && (n = !0)
        } else n = !0;
        return n
    }, w.prototype.judeTriggerProps = function (e, t, n) {
        var o = this.judeRule(e, t);
        if ("{}" !== JSON.stringify(t.xcontext) && null !== t.xcontext || !o) {
            var a = 0;
            for (var i in t.xcontext) a++;
            for (var r in t.xcontext) {
                var s = 0, l = "$url_domain" === r ? x.getUrlDomain(t.xcontext[r]) : t.xcontext[r];
                for (var c in e.xcontext) {
                    var d = !("$url" !== c || "$url_domain" !== r),
                        u = d ? x.getUrlDomain(e.xcontext[c]) : e.xcontext[c], f = !1;
                    (r === c && "$url" === c || d) && (f = x.isMatch(l, u)), r !== c && !d || l !== u ? f && ++s === a && o && n && n() : ++s === a && o && n && n()
                }
            }
        } else n && n()
    }, w.prototype.setUserId = function (e) {
        this.userId = e, b = e, T.setSession("EAUSERID", e)
    }, w.prototype.setToken = function (e) {
        this.token = e, E = e
    }, window.ansModalClose = function (e, t) {
        var n = e;
        if ("{}" === n) {
            for (var o = T.getLocal("POPMODALDATA" + b), a = 0; a < o.length; a++) if (o[a].id === t) {
                n = o[a];
                break
            }
            t = "AnalysysModal" + t
        }
        A(n, "close"), S("$closeDialog", {activityId: n.id.toString(), $dialog_type: 3}), M(t)
    }, window.ansModalOK = function (e, t, n) {
        var o = e;
        if ("{}" === o) {
            for (var a = T.getLocal("POPMODALDATA" + b), i = 0; i < a.length; i++) if (a[i].id === t) {
                o = a[i];
                break
            }
            n === undefined ? o.href = o.buttonMiddle && o.buttonMiddle.clickEvent || "" : o.href = "undefined" === n ? "" : n, t = "AnalysysModal" + t
        }
        A(o, "click"), S("$clickDialog", {
            activityId: o.id.toString(),
            $dialog_type: 6
        }), M(t, !!o.href), o.href && setTimeout(function () {
            window.location.href = o.href
        }, 0)
    };
    var P = w.getInstance(), R = P.setConfig(), N = !0;
    P.mergeLocalData(), window.AnalysysModal = function (e, t) {
        if (R) {
            N && console.log("EA -- 寮圭獥寮曞叆鎴愬姛"), N = !1;
            var n = [];
            if ("sensors" === t) {
                var o = {};
                for (var a in e.lib) o[a] = e.lib[a];
                for (var i in e.properties) o[i] = e.properties[i];
                n = [{xwho: e.distinct_id, xwhat: e.event || e.type, xcontext: o}]
            } else n = e;
            P.init(n)
        }
    }
});